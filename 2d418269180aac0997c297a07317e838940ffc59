{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "0226bee7_8ce6bb98",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1750078
      },
      "writtenOn": "2023-11-14T11:38:30Z",
      "side": 1,
      "message": "Depfiles are not used when compiling Cronet in AOSP. They are remnants that we had to copy over from Chromium due to how Chromium build system works, If we merge this change then the next import will certainly overwrite it and we don\u0027t want that to happen. We should probably stop using depfiles completely by setting them to some empty path.\n\nIf this is urgent then we can merge it. However, this is a short-term solution.",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "74f0d783_f0676d3f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1112368
      },
      "writtenOn": "2023-11-14T14:51:37Z",
      "side": 1,
      "message": "I get what you\u0027re saying, but at least for Android 14 it makes sense to pull this in and merge my opinion.\n\nconsidering that working toward depfile deprecation sounds like a longer road.",
      "parentUuid": "0226bee7_8ce6bb98",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "847b44b7_7994d660",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1112368
      },
      "writtenOn": "2023-11-14T14:51:55Z",
      "side": 1,
      "message": "and to clarify, I picked this change to Android 14-dev on the same change ID",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1be6b8b6_b0243e86",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1743321
      },
      "writtenOn": "2023-11-20T11:52:32Z",
      "side": 1,
      "message": "\u003e Depfiles are not used when compiling Cronet in AOSP\n\nIf this is really the case, can we just drop the offending assert instead of \"making it happy\"?\n\nTo expand: AFAIU, @aymanm@google.com is saying that this code doesn\u0027t really do anything in AOSP, because its purpose is to generate intermediate depfiles, which gn2bp/Soong don\u0027t end up using. It just so happens that an assert within this code fails in certain scenarios which are possible in AOSP.\n\nGiven the above, instead of trying to get this code right, we should really just remove the assert at line 78. This would also minimize the diff from upstream.",
      "parentUuid": "74f0d783_f0676d3f",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ff19d597_ad0f9709",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1112368
      },
      "writtenOn": "2023-11-21T16:36:56Z",
      "side": 1,
      "message": "Potentially, but that could take some time to untangle - point of this was to bandaid it in the QPR, as it\u0027s entirely broken right now.\n\nWe can always follow this up with removal if possible?",
      "parentUuid": "1be6b8b6_b0243e86",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "05335ce2_ae80433b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1112368
      },
      "writtenOn": "2023-11-21T16:37:35Z",
      "side": 1,
      "message": "so, I supposed, merging the android14-dev version of this and leaving the main version pending a better fix? That okay?",
      "parentUuid": "ff19d597_ad0f9709",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4abeb1d8_6da6daee",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1947461
      },
      "writtenOn": "2023-12-04T02:52:44Z",
      "side": 1,
      "message": "If this is not used to build Cronet in AOSP, why we need this change?\nCould you explain the issue you are facing?",
      "parentUuid": "05335ce2_ae80433b",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6cd5d621_fbc42f3b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1112368
      },
      "writtenOn": "2023-12-04T02:54:40Z",
      "side": 1,
      "message": "I hate to say this, but the commit message details it.\n\nIt /is/ used, try building current Android 14 with a custom OUT dir, or OUT_DIR_COMMON_BASE",
      "parentUuid": "4abeb1d8_6da6daee",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "60c60c0d_b853758b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1947461
      },
      "writtenOn": "2023-12-04T03:40:29Z",
      "side": 1,
      "message": "I see, so generated depfiles are not used but this code path is used to build Cronet in AOSP.",
      "parentUuid": "6cd5d621_fbc42f3b",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "72e9ca38_37994695",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1947461
      },
      "writtenOn": "2023-12-05T03:12:37Z",
      "side": 1,
      "message": "As @aymanm@google.com mentions, `build/action_helpers.py` will be overwritten by the next import and we have the import regularly.  \nSo, I think this change will be overwritten soon.\nI\u0027m not sure if this is ok for you.\n\nPossible solutions to avoid being overwritten would be\n1) Updates `external/cronet/android/tools/gn2bp/gen_android_bp` to support custom out directory.\n`gen_android.bp` is a script to generate `external/cronet/Android.bp`.\nAnd this script will not be overwritten by the import.\n\n2) Upstream the fix to chromium.\nWe will import chromium code to aosp regularly.\nSo if the upstream have the fix, aosp will have the fix by the next import.\n\n@aymanm@google.com, If I\u0027m wrong, please correct me.",
      "parentUuid": "60c60c0d_b853758b",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "391167f0_32b18e03",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1112368
      },
      "writtenOn": "2023-12-05T03:14:02Z",
      "side": 1,
      "message": "Where can I send this for the upstream, do they have a Gerrit instance as well?",
      "parentUuid": "72e9ca38_37994695",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5751becb_66b458b5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1750078
      },
      "writtenOn": "2023-12-05T12:22:32Z",
      "side": 1,
      "message": "What Motomu said is correct, There are two possible long-term solutions here:\n\n1) We change how gn2bp handles JNI Registration targets, See [here](https://cs.android.com/android/platform/superproject/main/+/main:external/cronet/android/tools/gn2bp/gen_android_bp;l\u003d1021) where we add the absolute path of the files to the `java.sources` file, this should be changed to the relative path which will fix the problem and make everyone happy.\n\n2) Stop Chromium from asserting for absolute paths when writing to depfile. This solution might be a little bit more complicated because you will have to deal with Chromium and import Cronet into AOSP which is something you really want to avoid.\n\nI will try to implement solution (1) today and upload a CL for it.",
      "parentUuid": "391167f0_32b18e03",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c7411b52_0dde31b9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1112368
      },
      "writtenOn": "2024-01-17T03:30:14Z",
      "side": 1,
      "message": "were you able to try get this uploaded?",
      "parentUuid": "5751becb_66b458b5",
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cf20cb55_9c781fd7",
        "filename": "build/action_helpers.py",
        "patchSetId": 3
      },
      "lineNbr": 84,
      "author": {
        "id": 1750078
      },
      "writtenOn": "2023-11-14T15:52:52Z",
      "side": 1,
      "message": "This is also not used anywhere.",
      "range": {
        "startLine": 84,
        "startChar": 2,
        "endLine": 84,
        "endChar": 87
      },
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3bb2dfb2_a518a64c",
        "filename": "build/action_helpers.py",
        "patchSetId": 3
      },
      "lineNbr": 84,
      "author": {
        "id": 1112368
      },
      "writtenOn": "2023-11-15T03:38:37Z",
      "side": 1,
      "message": "Sorry, in cleaning up this patch from PS1, important bits were lost, fixed.",
      "parentUuid": "cf20cb55_9c781fd7",
      "range": {
        "startLine": 84,
        "startChar": 2,
        "endLine": 84,
        "endChar": 87
      },
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6f33a609_935e1e70",
        "filename": "build/action_helpers.py",
        "patchSetId": 3
      },
      "lineNbr": 90,
      "author": {
        "id": 1750078
      },
      "writtenOn": "2023-11-14T15:52:52Z",
      "side": 1,
      "message": "Why are we excluding java.sources?",
      "range": {
        "startLine": 90,
        "startChar": 4,
        "endLine": 90,
        "endChar": 93
      },
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f526f759_2e7af1b2",
        "filename": "build/action_helpers.py",
        "patchSetId": 3
      },
      "lineNbr": 90,
      "author": {
        "id": 1112368
      },
      "writtenOn": "2023-11-15T03:38:37Z",
      "side": 1,
      "message": "Not sure if this is leftover from some debugging, or intentional, I\u0027ll ask commit author.",
      "parentUuid": "6f33a609_935e1e70",
      "range": {
        "startLine": 90,
        "startChar": 4,
        "endLine": 90,
        "endChar": 93
      },
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1bd66f84_66248540",
        "filename": "build/action_helpers.py",
        "patchSetId": 3
      },
      "lineNbr": 90,
      "author": {
        "id": 1112368
      },
      "writtenOn": "2023-11-15T22:38:06Z",
      "side": 1,
      "message": "tried it locally, if we removed this:\n\nssertionError: Found abs path in depfile: /mnt/out/out/lineage-21/soong/.temp/sbox/5bccfcc00b5157e46d70a548da1566d61a4a83d3/out/java.sources\nexit status 1\n[ 35% 60844/172580] //external/cronet:cronet_aml_components_cronet_android_cronet_jni_reg\nFAILED: /mnt/out/out/lineage-21/soong/.intermediates/external/cronet/cronet_aml_components_cronet_android_cronet_jni_registration__java/android_common/gen/components/cronet/android/cronet_jni_registration.srcjar\n/mnt/out/out/lineage-21/host/linux-x86/bin/sbox --sandbox-path /mnt/out/out/lineage-21/soong/.temp --output-dir /mnt/out/out/lineage-21/soong/.intermediates/external/cronet/cronet_aml_components_cronet_android_cronet_jni_registration__java/android_common/gen --manifest /mnt/out/out/lineage-21/soong/.intermediates/external/cronet/cronet_aml_components_cronet_android_cronet_jni_registration__java/android_common/genrule.sbox.textproto\nThe failing command was run inside an sbox sandbox in temporary directory\n/mnt/out/out/lineage-21/soong/.temp/sbox/0a7ebcec3a9ebe954bdfd7984dfd096ece5d46cc\nThe failing command line can be found in\n/mnt/out/out/lineage-21/soong/.temp/sbox/0a7ebcec3a9ebe954bdfd7984dfd096ece5d46cc/sbox_command.0.bash\nTraceback (most recent call last):\n  File \"/mnt/out/out/lineage-21/soong/.temp/sbox/0a7ebcec3a9ebe954bdfd7984dfd096ece5d46cc/tools/src/external/cronet/base/android/jni_generator/jni_registration_generator.py\", line 921, in \u003cmodule\u003e\n    sys.exit(main(sys.argv))\n  File \"/mnt/out/out/lineage-21/soong/.temp/sbox/0a7ebcec3a9ebe954bdfd7984dfd096ece5d46cc/tools/src/external/cronet/base/android/jni_generator/jni_registration_generator.py\", line 916, in main\n    action_helpers.write_depfile(args.depfile, args.srcjar_path,\n  File \"/mnt/out/out/lineage-21/soong/.temp/sbox/0a7ebcec3a9ebe954bdfd7984dfd096ece5d46cc/tools/src/external/cronet/base/android/jni_generator/../../../build/android/gyp/util/../../../action_helpers.py\", line 91, in write_depfile\n    relative_inputs \u003d [_process_path(p) for p in set(inputs)]\n  File \"/mnt/out/out/lineage-21/soong/.temp/sbox/0a7ebcec3a9ebe954bdfd7984dfd096ece5d46cc/tools/src/external/cronet/base/android/jni_generator/../../../build/android/gyp/util/../../../action_helpers.py\", line 91, in \u003clistcomp\u003e\n    relative_inputs \u003d [_process_path(p) for p in set(inputs)]\n  File \"/mnt/out/out/lineage-21/soong/.temp/sbox/0a7ebcec3a9ebe954bdfd7984dfd096ece5d46cc/tools/src/external/cronet/base/android/jni_generator/../../../build/android/gyp/util/../../../action_helpers.py\", line 78, in _process_path\n    assert not os.path.isabs(path), f\u0027Found abs path in depfile: {path}\u0027\nAssertionError: Found abs path in depfile: /mnt/out/out/lineage-21/soong/.temp/sbox/0a7ebcec3a9ebe954bdfd7984dfd096ece5d46cc/out/java.sources\nexit status 1\n[ 35% 60861/172580] //packages/modules/Bluetooth/system/gd:BluetoothGeneratedPackets_rust\nout dir: \"/mnt/out/out/lineage-21/soong/.temp/sbox/2bf7d889d55cfcf13342d2325205585a6299e9aa/out\"\nparsing: \"/home/nolenjohnson/lineage-21/packages/modules/Bluetooth/system/gd/hci/hci_packets.pdl\"\ngenerating rust\ngenerating \"/mnt/out/out/lineage-21/soong/.temp/sbox/2bf7d889d55cfcf13342d2325205585a6299e9aa/out/hci/hci_packets.rs\"\n[ 35% 60866/172580] APK certs list: /mnt/out/out/lineage-21/target/product/nash/obj/PACKA\n    0:50 Building bootanimation.zip",
      "parentUuid": "f526f759_2e7af1b2",
      "range": {
        "startLine": 90,
        "startChar": 4,
        "endLine": 90,
        "endChar": 93
      },
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3dad47a4_58067686",
        "filename": "build/action_helpers.py",
        "patchSetId": 3
      },
      "lineNbr": 90,
      "author": {
        "id": 1750078
      },
      "writtenOn": "2023-11-16T11:34:15Z",
      "side": 1,
      "message": "Can you tell me how do you reproduce this? The commands used? This is important for me because I need to fix this long-term so I need to know how to reproduce this error.",
      "parentUuid": "1bd66f84_66248540",
      "range": {
        "startLine": 90,
        "startChar": 4,
        "endLine": 90,
        "endChar": 93
      },
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "392a9ed6_52cf3442",
        "filename": "build/action_helpers.py",
        "patchSetId": 3
      },
      "lineNbr": 90,
      "author": {
        "id": 1112368
      },
      "writtenOn": "2023-11-16T17:16:00Z",
      "side": 1,
      "message": "I am testing this largely on android14-dev.\n\nTo replicate there, just set OUT_DIR_COMMON_BASE to any absolute path. You will see cronet fail during build.\n\nOn main, the issue also exists, but is predicated by the need for https://android-review.googlesource.com/c/platform/system/sepolicy/+/2834710 (e.g. if you don\u0027t pick this, it fails much earlier, and you can\u0027t get to this error).",
      "parentUuid": "3dad47a4_58067686",
      "range": {
        "startLine": 90,
        "startChar": 4,
        "endLine": 90,
        "endChar": 93
      },
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5471cef9_2f24e89f",
        "filename": "build/action_helpers.py",
        "patchSetId": 3
      },
      "lineNbr": 93,
      "author": {
        "id": 1750078
      },
      "writtenOn": "2023-11-14T15:52:52Z",
      "side": 1,
      "message": "This is not used anywhere",
      "range": {
        "startLine": 92,
        "startChar": 4,
        "endLine": 93,
        "endChar": 61
      },
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9449d5c6_e820a41a",
        "filename": "build/action_helpers.py",
        "patchSetId": 3
      },
      "lineNbr": 93,
      "author": {
        "id": 1112368
      },
      "writtenOn": "2023-11-15T03:38:37Z",
      "side": 1,
      "message": "Sorry, in cleaning up this patch from PS1, important bits were lost, fixed.",
      "parentUuid": "5471cef9_2f24e89f",
      "range": {
        "startLine": 92,
        "startChar": 4,
        "endLine": 93,
        "endChar": 61
      },
      "revId": "2d418269180aac0997c297a07317e838940ffc59",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}