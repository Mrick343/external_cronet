{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "6c9d5ddd_8ba4e586",
        "filename": "components/cronet/android/java/src/org/chromium/net/impl/CronetImpl.java",
        "patchSetId": 7
      },
      "lineNbr": 6,
      "author": {
        "id": 1594463
      },
      "writtenOn": "2023-06-30T18:43:32Z",
      "side": 1,
      "message": "I wonder if this should be an abstract class with an implementation of a static newInstance() method. I would prefer if CronetImpl was self-contained and completely abstracted away loading its own implementation.\n\nIf we wanted to go a step further, we could have (which is almost equivalent to c++\u0027s pimpl idiom ðŸ˜Š):\n```\npublic interface ISystemDependencies { // \u003c-- we should find a good name for this\n    public CronetSource getCronetSource();\n}\n\npublic class SystemDependencies implements ISystemDependencies {\n    private static final String IMPL_CLASS \u003d \"android.net.http.AospDependencies\";\n    private final ISystemDependencies mImpl;\n\n    public SystemDependencies() {\n        mImpl \u003d Class.forName(IMPL_CLASS).newInstance();\n    }\n\n    public CronetSource getCronetSource() {\n        return mImpl.getCronetSource();\n    }\n}\n\npublic class AospDependencies implements ISystemDependencies {\n    public CronetSource getCronetSource() {\n        return CronetSource.CRONET_SOURCE_PLATFORM;\n    }\n}\n```\n\nOne question still haven\u0027t solved with this though: How does //net call into AOSP-only code? Presumably, there would be no way for net to access SystemDependencies without creating some weird circular dependency. I guess we could duplicate this pattern in Cronet as well as //net, but that\u0027s not particularly pretty either. One hacky(?) way around this might be to move SystemDependencies to //net. Since it doesn\u0027t create a direct dependency on its implementation (thanks to the reflection), the actual implementation could still live in and depend on Cronet.\n\n---\n\nAdditional note: In a perfect world, the value of SystemDependencies#IMPL_CLASS should come from NetFeatures.java (see [//net/base:java_features_srcjar](https://source.chromium.org/chromium/chromium/src/+/main:net/base/BUILD.gn;l\u003d8))\n\n\nLet\u0027s discuss this next week.",
      "range": {
        "startLine": 6,
        "startChar": 0,
        "endLine": 6,
        "endChar": 29
      },
      "revId": "cd79b44e605de4033a3fb5f85c0d5333256e57cd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "470f2309_fd8c8128",
        "filename": "components/cronet/android/java/src/org/chromium/net/impl/CronetUrlRequestContext.java",
        "patchSetId": 7
      },
      "lineNbr": 67,
      "author": {
        "id": 1594463
      },
      "writtenOn": "2023-06-30T18:43:32Z",
      "side": 1,
      "message": "I think this should be encapsulated within CronetImpl.",
      "range": {
        "startLine": 66,
        "startChar": 32,
        "endLine": 67,
        "endChar": 54
      },
      "revId": "cd79b44e605de4033a3fb5f85c0d5333256e57cd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}