{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "45a2f7c7_f71de194",
        "filename": "Android.extras.bp",
        "patchSetId": 4
      },
      "lineNbr": 210,
      "author": {
        "id": 1594463
      },
      "writtenOn": "2023-03-24T10:39:45Z",
      "side": 1,
      "message": "Can you leave a comment on why this is needed?\nAlso, I am curious if just referencing \"framework-connectivity\" would do the right thing?",
      "revId": "ee4e113df084237aa3521f49fd61021212f3ea22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "48b09da0_5ba53238",
        "filename": "Android.extras.bp",
        "patchSetId": 4
      },
      "lineNbr": 210,
      "author": {
        "id": 1976566
      },
      "writtenOn": "2023-03-24T14:26:45Z",
      "side": 1,
      "message": "Why do we need the comment?",
      "parentUuid": "45a2f7c7_f71de194",
      "revId": "ee4e113df084237aa3521f49fd61021212f3ea22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dda20f6e_e577d8ff",
        "filename": "components/cronet/android/test/javatests/src/org/chromium/net/CronetTestRule.java",
        "patchSetId": 4
      },
      "lineNbr": 334,
      "author": {
        "id": 1743321
      },
      "writtenOn": "2023-03-24T10:25:24Z",
      "side": 1,
      "message": "Is there any documentation about this being supported?\n\nI think that a safer long term solution would be to wrap the factory returned by `cronetEngine.createUrlStreamHandlerFactory` into something that can toggle between  the default system\u0027s factory and cronet\u0027s factory (and that can possibly reset the internal cronet\u0027s factory, if we want to drop state).\n\nP.S. Why is this needed here but not upstream?",
      "range": {
        "startLine": 332,
        "startChar": 12,
        "endLine": 334,
        "endChar": 36
      },
      "revId": "ee4e113df084237aa3521f49fd61021212f3ea22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5fbbad3c_cdc10345",
        "filename": "components/cronet/android/test/javatests/src/org/chromium/net/CronetTestRule.java",
        "patchSetId": 4
      },
      "lineNbr": 334,
      "author": {
        "id": 1976566
      },
      "writtenOn": "2023-03-24T10:45:52Z",
      "side": 1,
      "message": "What do you mean by being supported?\n\nTypically, people don\u0027t need to switch between the system\u0027s factory vs cronet for their apps. We only need to do this to test cronet\u0027s impl vs the system\u0027s.\n\nThis was not needed in chromium because in chromium, the test_runner runs each test on separate JVM which allowed us to run the urlconnectiontests without resetting the urlstreamfactory. This is not the case for here where the tests are run on the same JVM instance, and Factory cannot be set more than once.\n\nhttps://luci-logdog.appspot.com/logs/chromium/android/swarming/logcats/612bf86400c63711/+/logcat_logcat_org.chromium.net.urlconnection.CronetBufferedOutputStreamTest.testWriteAfterConnect_shard0_20230324T103723-UTC_emulator-5554 where ART init is called after each test.",
      "parentUuid": "dda20f6e_e577d8ff",
      "range": {
        "startLine": 332,
        "startChar": 12,
        "endLine": 334,
        "endChar": 36
      },
      "revId": "ee4e113df084237aa3521f49fd61021212f3ea22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cc42ed97_50237a28",
        "filename": "components/cronet/android/test/javatests/src/org/chromium/net/CronetTestRule.java",
        "patchSetId": 4
      },
      "lineNbr": 334,
      "author": {
        "id": 1743321
      },
      "writtenOn": "2023-03-24T10:55:45Z",
      "side": 1,
      "message": "From https://docs.oracle.com/javase/7/docs/api/java/net/URL.html#setURLStreamHandlerFactory(java.net.URLStreamHandlerFactory):\n```\npublic static void setURLStreamHandlerFactory(URLStreamHandlerFactory fac)\nSets an application\u0027s URLStreamHandlerFactory. This method can be called at most once in a given Java Virtual Machine\n```\n\nThis is probably forbidden due to some implementation details. Bypassing this restriction through reflection might work now just out of luck and could easily break on system updates (or be prone to race conditions etc).\n\nIf this is not documented anywhere, we should not do this and instead do something along the lines of what I\u0027ve suggested above.",
      "parentUuid": "5fbbad3c_cdc10345",
      "range": {
        "startLine": 332,
        "startChar": 12,
        "endLine": 334,
        "endChar": 36
      },
      "revId": "ee4e113df084237aa3521f49fd61021212f3ea22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5ca1151_98c07097",
        "filename": "components/cronet/android/test/javatests/src/org/chromium/net/CronetTestRule.java",
        "patchSetId": 4
      },
      "lineNbr": 334,
      "author": {
        "id": 1976566
      },
      "writtenOn": "2023-03-24T14:26:45Z",
      "side": 1,
      "message": "Toggling between the factory won\u0027t work as we can\u0027t toggle the URL\u0027s factory once it\u0027s set.\n\nWhat we can do is to modifiy `CronetURLStreamHandlerFactory.createStreamHandler` to return null if we want to use the systems impl.\n\nI\u0027ll not do this in this cl as we need to consider if we really do want to do that inside the CronetURLStreamFactory impl. I\u0027ve created b/2505921 to move this along and have drafted this cl aosp/2505921.\n\nResolve and LGTM if this SGTY.",
      "parentUuid": "cc42ed97_50237a28",
      "range": {
        "startLine": 332,
        "startChar": 12,
        "endLine": 334,
        "endChar": 36
      },
      "revId": "ee4e113df084237aa3521f49fd61021212f3ea22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "934c975c_7c27e84a",
        "filename": "components/cronet/android/test/javatests/src/org/chromium/net/CronetTestRule.java",
        "patchSetId": 4
      },
      "lineNbr": 334,
      "author": {
        "id": 1594463
      },
      "writtenOn": "2023-03-24T14:39:19Z",
      "side": 1,
      "message": "I think what you want is a ProxyURLStreamHandlerFactory that has a public method between two implementations. For one implementation, you forward the call to createURLStreamHandler() to CronetURLStreamHandlerFactory. And for the other implementation you return null. This feels easy enough to just do, or am I missing something?\n\nThat being said, this still sort of relies on java.net implementation details, and we might not want this to be the long-term solution (and try to re-architect the test instead).",
      "parentUuid": "b5ca1151_98c07097",
      "range": {
        "startLine": 332,
        "startChar": 12,
        "endLine": 334,
        "endChar": 36
      },
      "revId": "ee4e113df084237aa3521f49fd61021212f3ea22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c474c45b_f2ed2668",
        "filename": "patches/upstream-next/0017-Setup-urlconnection-for-Cronet-MTS.patch",
        "patchSetId": 4
      },
      "lineNbr": 15,
      "author": {
        "id": 1594463
      },
      "writtenOn": "2023-03-24T10:39:45Z",
      "side": 1,
      "message": "I am in the process of deleting all .patch files that do not touch any BUILD.gn (and therefore don\u0027t affect the the output of `gn desc`), so I think we don\u0027t actually need this anymore.",
      "range": {
        "startLine": 1,
        "startChar": 0,
        "endLine": 15,
        "endChar": 50
      },
      "revId": "ee4e113df084237aa3521f49fd61021212f3ea22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d15650db_98fbaf84",
        "filename": "patches/upstream-next/0017-Setup-urlconnection-for-Cronet-MTS.patch",
        "patchSetId": 4
      },
      "lineNbr": 15,
      "author": {
        "id": 1976566
      },
      "writtenOn": "2023-03-24T14:26:45Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c474c45b_f2ed2668",
      "range": {
        "startLine": 1,
        "startChar": 0,
        "endLine": 15,
        "endChar": 50
      },
      "revId": "ee4e113df084237aa3521f49fd61021212f3ea22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}